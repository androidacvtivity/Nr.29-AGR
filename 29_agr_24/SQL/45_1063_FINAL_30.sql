
SELECT
ORDINE,
PARENT_CUIIO,
PARENT_CUATM,
DENUMIRE,
IDNO,
COL1 AS COL1
FROM 

(
SELECT
ROWNUM  ORDINE,
PARENT_CUIIO,
PARENT_CUATM,
DENUMIRE,
IDNO,
SUM(COL1) AS COL1
FROM

(
SELECT
DISTINCT D.PARENT_CUIIO,
D.DENUMIRE,
D.PARENT_CUATM,
MAX(D.IDNO) IDNO,
MAX(D.ORDINE) ORDINE,

SUM(D.COL1) AS COL1

FROM
(
SELECT
D.CUIIO,
D.PARENT_CUIIO,
D.CUIIO_VERS,
D.DENUMIRE,
D.CUATM,
D.PARENT_CUATM,
D.CFP,
D.CFOJ,
D.CAEM2,
D.IDNO,
D.ORDINE,
R.COL1
FROM KATALOG_45_1063_24 D   LEFT JOIN (
SELECT
D.CUIIO,
D.CUIIO_VERS,
SUM(D.COL1) AS COL1


FROM
  CIS2.VW_DATA_ALL D
  INNER JOIN CIS2.RENIM R1 ON (D.CUIIO=R1.CUIIO AND D.CUIIO_VERS=R1.CUIIO_VERS)
WHERE
  D.PERIOADA IN (:pPERIOADA) AND
  D.FORM IN (:pFORM) AND
  D.capitol=399
  AND D.RIND IN ('2000')



  GROUP BY
  D.CUIIO,
  D.CUIIO_VERS
) R ON R.CUIIO = D.CUIIO AND R.CUIIO_VERS = D.CUIIO_VERS


WHERE
1=1
--AND  D.CUIIO IN (38670189602,3867018)
ORDER BY
ORDINE

) D


GROUP BY
D.PARENT_CUIIO,
D.DENUMIRE,
D.PARENT_CUATM


ORDER BY
ORDINE

)


GROUP BY

ROWNUM,
PARENT_CUIIO,
DENUMIRE,
IDNO,
PARENT_CUATM



UNION 

SELECT
0 ORDINE,
NULL PARENT_CUIIO,
NULL PARENT_CUATM,
'Total'  DENUMIRE,
NULL IDNO, 
SUM(COL1) AS COL1
FROM
(
SELECT 
D.PARENT_CUIIO,	
SUM(D.COL1) AS COL1
FROM
(
SELECT 
D.CUIIO,	
D.PARENT_CUIIO,	
D.CUIIO_VERS,	
D.DENUMIRE,	
D.CUATM,	
D.PARENT_CUATM,	
D.CFP,	
D.CFOJ,	
D.CAEM2,	
D.IDNO,	
D.ORDINE,
R.COL1
FROM KATALOG_45_1063_24 D   LEFT JOIN (
SELECT 
D.CUIIO,
D.CUIIO_VERS,
SUM(D.COL1) AS COL1


FROM
  CIS2.VW_DATA_ALL D
  INNER JOIN CIS2.RENIM R1 ON (D.CUIIO=R1.CUIIO AND D.CUIIO_VERS=R1.CUIIO_VERS)
WHERE
  D.PERIOADA IN (:pPERIOADA) AND
  D.FORM IN (:pFORM) AND 
  D.capitol=399
  AND D.RIND IN ('2000')
  
  
  --1144881
  
  
  GROUP BY
  D.CUIIO,
  D.CUIIO_VERS
) R ON R.CUIIO = D.CUIIO AND R.CUIIO_VERS = D.CUIIO_VERS 


WHERE
1=1 
--AND  D.CUIIO IN (38670189602,3867018)
ORDER BY 
ORDINE

) D


GROUP BY
D.PARENT_CUIIO,	
D.ORDINE

ORDER BY 
D.ORDINE
)

)


WHERE
COL1 IS NOT NULL 

ORDER BY

ORDINE

